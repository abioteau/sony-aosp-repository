From 93d7228217afa6a7b07b0df21d46b333847524e9 Mon Sep 17 00:00:00 2001
From: Alin Jerpelea <alin.jerpelea@sony.com>
Date: Thu, 9 Aug 2018 09:34:06 +0200
Subject: [PATCH] hal: enable audio hal on sdm660

the sdm660 SOC can use the same HAL as the other QCOM SOCs

Test: manual - build, boots and audio works

Change-Id: I0edd5fa2c67eb7a96a44e907060dcbb273e983ac
Signed-off-by: Alin Jerpelea <alin.jerpelea@sony.com>
---
 Android.mk            | 2 +-
 hal/Android.mk        | 2 +-
 hal/msm8916/hw_info.c | 7 ++++++-
 3 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/Android.mk b/Android.mk
index d6f03fb..02de665 100644
--- a/Android.mk
+++ b/Android.mk
@@ -1,6 +1,6 @@
 # TODO:  Find a better way to separate build configs for ADP vs non-ADP devices
 ifneq ($(TARGET_BOARD_AUTO),true)
-  ifneq ($(filter msm8960 msm8226 msm8x26 msm8x84 msm8084 msm8992 msm8994 msm8996 msm8909 msm8952 msm8998 sdm845,$(TARGET_BOARD_PLATFORM)),)
+  ifneq ($(filter msm8960 msm8226 msm8x26 msm8x84 msm8084 msm8992 msm8994 msm8996 msm8909 msm8952 msm8998 sdm660 sdm845,$(TARGET_BOARD_PLATFORM)),)
 
     MY_LOCAL_PATH := $(call my-dir)
 
diff --git a/hal/Android.mk b/hal/Android.mk
index 3ce2d2b..18e5b77 100644
--- a/hal/Android.mk
+++ b/hal/Android.mk
@@ -57,7 +57,7 @@ ifneq ($(filter sdm845,$(TARGET_BOARD_PLATFORM)),)
 endif
 endif
 
-ifneq ($(filter msm8916 msm8909 msm8952,$(TARGET_BOARD_PLATFORM)),)
+ifneq ($(filter msm8916 msm8909 msm8952 sdm660,$(TARGET_BOARD_PLATFORM)),)
   AUDIO_PLATFORM = msm8916
   LOCAL_CFLAGS := -DPLATFORM_MSM8916
 ifneq ($(filter msm8909,$(TARGET_BOARD_PLATFORM)),)
diff --git a/hal/msm8916/hw_info.c b/hal/msm8916/hw_info.c
index 095d052..de4e6a7 100644
--- a/hal/msm8916/hw_info.c
+++ b/hal/msm8916/hw_info.c
@@ -56,8 +56,12 @@ static void update_hardware_info_8x16(struct hardware_info *hw_info, const char
         strlcpy(hw_info->name, "msm8952", sizeof(hw_info->name));
     } else if (!strcmp(snd_card_name, "msm8976-tasha-snd-card")) {
         strlcpy(hw_info->name, "msm8976", sizeof(hw_info->name));
+    } else if (!strcmp(snd_card_name, "sdm660-snd-card")) {
+        strlcpy(hw_info->name, "sdm660", sizeof(hw_info->name));
+    } else if (!strcmp(snd_card_name, "sdm660-tasha-snd-card")) {
+        strlcpy(hw_info->name, "sdm660", sizeof(hw_info->name));
     } else {
-        ALOGW("%s: Not an 8x16/8909/8952/8976 device", __func__);
+        ALOGW("%s: Not an 8x16/8909/8952/8976/sdm660 device", __func__);
     }
 }
 
@@ -73,6 +77,7 @@ void *hw_info_init(const char *snd_card_name)
 
     if (strstr(snd_card_name, "msm8x16") || strstr(snd_card_name, "msm8909") ||
         strstr(snd_card_name, "msm8952") || strstr(snd_card_name, "msm8976") ||
+	strstr(snd_card_name, "sdm660") ||
         strstr(snd_card_name, "msm-bg-snd-card")) {
         ALOGV("8x16 - variant soundcard");
 
-- 
2.13.0

